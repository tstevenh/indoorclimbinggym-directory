---
/**
 * Homepage
 * Main landing page with hero, featured gyms, and popular cities
 */
import BaseLayout from '../layouts/BaseLayout.astro';
import GymCard from '../components/GymCard.astro';
import SearchBar from '../components/SearchBar.astro';
import { generateOrganizationSchema, generateWebSiteSchema } from '../utils/schema';
import { fetchGyms } from '../config/api';
import { getStateCode, getStateSlug, getStateName } from '../utils/states';

export const prerender = true;

// Fetch gyms from API at build time
const gyms = await fetchGyms();

// Get featured gyms (if any)
const allFeaturedGyms = gyms.filter(g => g.featured);

// Get top-rated gyms as fallback
const topRatedGyms = [...gyms].sort((a, b) => {
  // By rating (highest first)
  if (a.rating !== b.rating) return b.rating - a.rating;
  // Then alphabetically
  return a.name.localeCompare(b.name);
});

// Show featured if we have 3+, otherwise show top-rated
const displayGyms = allFeaturedGyms.length >= 3
  ? allFeaturedGyms.slice(0, 6)
  : topRatedGyms.slice(0, 6);

const sectionTitle = allFeaturedGyms.length >= 3
  ? "Featured Climbing Gyms"
  : "Top Rated Climbing Gyms";

// Calculate states by gym count
const stateCounts = gyms.reduce((acc, gym) => {
  const state = gym.region?.toLowerCase();
  if (state) {
    acc[state] = (acc[state] || 0) + 1;
  }
  return acc;
}, {} as Record<string, number>);

// Get top 9 states sorted by gym count
const topStates = Object.entries(stateCounts)
  .sort(([, countA], [, countB]) => countB - countA)
  .slice(0, 9)
  .map(([state, count]) => ({ state, count }));

// Get unique cities
const cities = [...new Set(gyms.map(g => ({ city: g.city, region: g.region, slug: g.slug })))];
const popularCities = cities.slice(0, 6);

// Define top 8 curated categories with gym counts
const topCategories = [
  {
    name: 'Best Bouldering Gyms',
    slug: 'best-bouldering-climbing-gyms',
    count: gyms.filter(g => g.climbing_types?.includes('bouldering')).length
  },
  {
    name: 'For Beginners',
    slug: 'best-climbing-gyms-for-beginners',
    count: gyms.filter(g => g.beginner_friendly).length
  },
  {
    name: 'Best Lead Climbing Gyms',
    slug: 'best-lead-climbing-gyms',
    count: gyms.filter(g => g.climbing_types?.includes('lead')).length
  },
  {
    name: 'Best Top Rope Gyms',
    slug: 'best-top-rope-climbing-gyms',
    count: gyms.filter(g => g.climbing_types?.includes('top_rope')).length
  },
  {
    name: 'Affordable Gyms',
    slug: 'affordable-climbing-gyms',
    count: gyms.filter(g => g.day_pass_price_local && g.day_pass_price_local <= 20).length
  },
  {
    name: 'With Sauna',
    slug: 'climbing-gyms-with-sauna',
    count: gyms.filter(g => g.amenities?.includes('sauna')).length
  },
  {
    name: 'With Kids Zone',
    slug: 'climbing-gyms-with-kids-zone',
    count: gyms.filter(g => g.amenities?.includes('kids_zone')).length
  },
  {
    name: 'With WiFi',
    slug: 'climbing-gyms-with-wifi',
    count: gyms.filter(g => g.amenities?.includes('wifi')).length
  },
];

// State utilities imported above

// Generate homepage schemas
const orgSchema = generateOrganizationSchema();
const websiteSchema = generateWebSiteSchema();
const combinedSchema = [orgSchema, websiteSchema];

// SEO data
const title = 'Find Best Climbing Gyms Near You | IndoorClimbingGym';
const description = 'Discover indoor climbing gyms near you. Search by location, amenities, and type. Browse 15+ gyms across 5 cities with reviews, prices, and directions.';
const canonical = 'https://www.indoorclimbinggym.com';
---

<BaseLayout
  title={title}
  description={description}
  canonical={canonical}
  schema={combinedSchema}
>
  <!-- Hero Section -->
  <section class="w-screen relative left-1/2 right-1/2 -ml-[50vw] -mr-[50vw] -mt-8 min-h-[600px] bg-gradient-to-br from-sage/30 via-ivory to-sage/10 py-16 md:py-24 mb-12">
    <div class="container mx-auto px-4">
      <div class="max-w-4xl mx-auto text-center">
        <h1 class="text-4xl md:text-6xl font-bold text-granite mb-6">
          Find the Best Indoor Climbing Gyms Near You
        </h1>
        <p class="text-xl md:text-2xl text-granite mb-8">
          Your complete guide to indoor climbing gyms across America. Search by location, amenities, and climbing type.
        </p>

        <!-- Hero Search Bar -->
        <div class="max-w-2xl mx-auto">
          <SearchBar large={true} placeholder="Search by city, state, or gym name..." />
        </div>

        <!-- Quick Stats -->
        <div class="grid grid-cols-3 gap-4 mt-12 max-w-2xl mx-auto">
          <div class="text-center">
            <div class="text-3xl font-bold text-sage">{gyms.length}</div>
            <div class="text-sm text-granite">Gyms</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-sage">{cities.length}</div>
            <div class="text-sm text-granite">Cities</div>
          </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-sage">
              {[...new Set(gyms.map(g => g.region))].length}
            </div>
            <div class="text-sm text-granite">States</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured Gyms Section -->
  <section class="mb-16">
    <div class="flex items-center justify-between mb-8">
      <div>
        <h2 class="text-3xl font-bold text-granite mb-2">{sectionTitle}</h2>
        <p class="text-gray-600">
          {allFeaturedGyms.length >= 3
            ? "Premium climbing gyms featured on our platform"
            : "Highly rated gyms from climbers like you"}
        </p>
      </div>
      <a href="/search" class="text-sage font-medium hover:underline">
        View All →
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {displayGyms.map(gym => (
        <GymCard gym={gym} />
      ))}
    </div>
  </section>

  <!-- Why Use IndoorClimbingGym.com Section -->
  <section class="bg-white rounded-lg shadow-md p-6 md:p-12 mb-16">
    <div class="text-center mb-12">
      <h2 class="text-2xl md:text-3xl font-bold text-granite mb-4 break-words px-2">Why Use IndoorClimbingGym.com?</h2>
      <p class="text-gray-600 text-base md:text-lg px-2">Your trusted partner for finding the perfect indoor climbing gym</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
          </svg>
        </div>
        <h3 class="font-bold text-granite mb-2 text-lg">Comprehensive Directory</h3>
        <p class="text-gray-600 text-sm">
          15+ climbing gyms across 5 major cities, from bouldering havens to full-service facilities
        </p>
      </div>

      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
          </svg>
        </div>
        <h3 class="font-bold text-granite mb-2 text-lg">Detailed Information</h3>
        <p class="text-gray-600 text-sm">
          Hours, prices, amenities, and directions for every gym—everything you need to plan your visit
        </p>
      </div>

      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z" />
          </svg>
        </div>
        <h3 class="font-bold text-granite mb-2 text-lg">Smart Filters</h3>
        <p class="text-gray-600 text-sm">
          Find gyms by climbing type, amenities, budget, and location—exactly what you're looking for
        </p>
      </div>

      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4">
          <svg class="w-8 h-8 text-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
          </svg>
        </div>
        <h3 class="font-bold text-granite mb-2 text-lg">Expert Guides</h3>
        <p class="text-gray-600 text-sm">
          Learn about climbing techniques, gear, gym etiquette, and training tips from experienced climbers
        </p>
      </div>
    </div>
  </section>

  <!-- Explore Climbing Gyms by Region Section -->
  <section class="mb-16 bg-gradient-to-br from-sage/10 to-ivory rounded-lg p-8 md:p-12">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold text-granite mb-4 text-center">Explore Indoor Climbing Gyms by Region</h2>
      <p class="text-gray-700 leading-relaxed text-center">
        From the Pacific Northwest's legendary bouldering scene in Seattle to the booming climbing community in Denver,
        indoor climbing gyms are transforming how people experience vertical sports. Whether you're in Texas's sunny Austin,
        California's vibrant Los Angeles, or New York City's bustling boroughs, there's a climbing gym waiting for you.
        Each region brings its unique climbing culture, from competitive bouldering walls to family-friendly facilities with
        beginner classes and youth programs.
      </p>
    </div>
  </section>

  <!-- Browse by State Section -->
  <section class="mb-16">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h2 class="text-3xl font-bold text-granite mb-2">Browse by State</h2>
        <p class="text-gray-600">Find climbing gyms across America by state</p>
      </div>
      <a href="/states" class="text-sage hover:text-sage/80 font-medium flex items-center gap-2">
        View All States
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {topStates.map(({ state, count }) => {
        // Use utility functions for proper state handling
        const stateCode = getStateCode(state);
        const stateSlug = getStateSlug(state);
        const fullName = getStateName(state);

        return (
          <a
            href={`/${stateSlug}`}
            class="block p-6 bg-white border border-gray-200 rounded-lg hover:border-sage hover:shadow-lg transition-all duration-300 group"
          >
            <div class="flex items-center justify-between mb-2">
              <h3 class="text-xl font-bold text-granite group-hover:text-sage transition-colors">
                {fullName}
              </h3>
              <span class="px-2 py-1 text-xs font-medium bg-sage/10 text-sage rounded-full uppercase">
                {stateCode}
              </span>
            </div>
            <p class="text-gray-600">
              {count} {count === 1 ? 'Climbing Gym' : 'Climbing Gyms'}
            </p>
          </a>
        );
      })}
    </div>
  </section>

  <!-- Categories Section -->
  <section class="mb-16">
    <div class="flex justify-between items-center mb-8">
      <div>
        <h2 class="text-3xl font-bold text-granite mb-2">Browse by Category</h2>
        <p class="text-gray-600">Find gyms that match your specific needs</p>
      </div>
      <a href="/categories" class="text-sage hover:text-sage/80 font-medium flex items-center gap-2">
        View All Categories
        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
        </svg>
      </a>
    </div>

    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      {topCategories.slice(0, 8).map(category => (
        <a
          href={`/categories/${category.slug}/1`}
          class="bg-white rounded-lg shadow-md p-6 hover:shadow-xl transition-shadow duration-300 group border-2 border-transparent hover:border-sage"
        >
          <h3 class="font-bold text-granite group-hover:text-sage transition-colors mb-2">
            {category.name}
          </h3>
          <p class="text-xs text-sage font-medium mt-2">{category.count} {category.count === 1 ? 'gym' : 'gyms'}</p>
        </a>
      ))}
    </div>
  </section>

  <!-- Getting Started Section -->
  <section class="mb-16 bg-white rounded-lg shadow-md p-8 md:p-12">
    <div class="text-center mb-10">
      <h2 class="text-3xl font-bold text-granite mb-4">New to Indoor Climbing?</h2>
      <p class="text-gray-600 text-lg">We make it easy to start your climbing journey</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 mb-8">
      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl font-bold text-sage">
          1
        </div>
        <h3 class="font-bold text-granite mb-2">Find Your Gym</h3>
        <p class="text-gray-600 text-sm">
          Browse our directory of indoor climbing gyms in your city and nearby areas
        </p>
      </div>

      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl font-bold text-sage">
          2
        </div>
        <h3 class="font-bold text-granite mb-2">Check Amenities</h3>
        <p class="text-gray-600 text-sm">
          Filter by bouldering, top rope, lead climbing, or specialized training facilities
        </p>
      </div>

      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl font-bold text-sage">
          3
        </div>
        <h3 class="font-bold text-granite mb-2">Read Reviews</h3>
        <p class="text-gray-600 text-sm">
          See ratings and reviews from real climbers to find the best fit for you
        </p>
      </div>

      <div class="text-center">
        <div class="w-16 h-16 bg-sage/20 rounded-full flex items-center justify-center mx-auto mb-4 text-3xl font-bold text-sage">
          4
        </div>
        <h3 class="font-bold text-granite mb-2">Visit & Climb</h3>
        <p class="text-gray-600 text-sm">
          Most gyms offer day passes and intro classes—perfect for first-timers
        </p>
      </div>
    </div>

    <div class="text-center">
      <a
        href="/guides/beginners-guide-to-climbing-gyms"
        class="inline-block bg-sage text-white px-8 py-3 rounded-lg font-bold hover:bg-sage/90 transition-colors"
      >
        Read Our Beginner's Guide
      </a>
    </div>
  </section>

  <!-- Guides Section -->
  <section class="mb-16 bg-gradient-to-br from-sage/10 to-ivory rounded-lg p-8">
    <div class="mb-8">
      <h2 class="text-3xl font-bold text-granite mb-2">Climbing Guides & Resources</h2>
      <p class="text-gray-600">Learn everything you need to know about indoor climbing</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <a
        href="/guides/beginners-guide-to-climbing-gyms"
        class="bg-white rounded-lg shadow-md p-6 hover:shadow-xl transition-shadow group"
      >
        <h3 class="font-bold text-granite group-hover:text-sage transition-colors mb-2">
          Beginner's Guide
        </h3>
        <p class="text-sm text-gray-600">
          Everything you need to know before your first visit
        </p>
      </a>

      <a
        href="/guides/what-to-wear-indoor-rock-climbing"
        class="bg-white rounded-lg shadow-md p-6 hover:shadow-xl transition-shadow group"
      >
        <h3 class="font-bold text-granite group-hover:text-sage transition-colors mb-2">
          What to Wear
        </h3>
        <p class="text-sm text-gray-600">
          Complete guide to climbing clothing and gear
        </p>
      </a>

      <a
        href="/guides/is-climbing-gym-membership-worth-it"
        class="bg-white rounded-lg shadow-md p-6 hover:shadow-xl transition-shadow group"
      >
        <h3 class="font-bold text-granite group-hover:text-sage transition-colors mb-2">
          Membership Guide
        </h3>
        <p class="text-sm text-gray-600">
          Is a climbing gym membership worth it?
        </p>
      </a>
    </div>

    <div class="text-center mt-8">
      <a
        href="/guides"
        class="inline-block text-sage font-medium hover:underline"
      >
        View all guides →
      </a>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="mb-12">
    <h2 class="text-3xl font-bold text-granite mb-6">
      Frequently Asked Questions
    </h2>
    <div class="space-y-6">
      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="font-bold text-granite text-lg mb-3">How much does it cost to climb at an indoor climbing gym?</h3>
        <p class="text-gray-700">
          Day passes typically range from $15-$30, depending on the facility and location. Monthly memberships usually cost
          between $50-$100, with many gyms offering student discounts and family packages. Most gyms also offer punch cards
          and multi-visit packages for better value.
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="font-bold text-granite text-lg mb-3">What should I wear to an indoor climbing gym?</h3>
        <p class="text-gray-700">
          Wear comfortable athletic clothing that allows full range of motion—think yoga pants, athletic shorts, or joggers
          with a t-shirt or tank top. Climbing shoes are essential (available to rent at most gyms for $3-$7). Avoid baggy
          clothes that might catch on holds, and remove jewelry before climbing.
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="font-bold text-granite text-lg mb-3">Do I need experience to start indoor rock climbing?</h3>
        <p class="text-gray-700">
          No experience needed! Indoor climbing gyms welcome beginners and most offer introductory classes, belay certification
          courses, and routes marked by difficulty level. Staff members are always available to help you get started safely.
          Many gyms require a brief orientation or safety video for first-time visitors.
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="font-bold text-granite text-lg mb-3">What's the difference between bouldering and rope climbing?</h3>
        <p class="text-gray-700">
          Bouldering involves climbing shorter walls (10-15 feet) without ropes, with padded mats below for protection.
          Rope climbing uses harnesses and belay systems for climbing taller walls (30-60 feet). Bouldering focuses on
          powerful, technical moves, while rope climbing emphasizes endurance and route-finding over longer distances.
        </p>
      </div>

      <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="font-bold text-granite text-lg mb-3">Can I go to a climbing gym alone?</h3>
        <p class="text-gray-700">
          Absolutely! Bouldering is perfect for solo climbers since no partner is needed. For rope climbing, many gyms
          offer auto-belay systems that let you climb alone, or have staff-run belay services. Climbing gyms are also
          great places to meet other climbers and make new friends who share your passion.
        </p>
      </div>
    </div>
  </section>

  <!-- CTA Section -->
  <section class="text-center bg-sage rounded-lg p-12 text-white">
    <h2 class="text-3xl font-bold mb-4">Ready to Find Your Next Climb?</h2>
    <p class="text-lg mb-8 text-white/90">
      Explore hundreds of climbing gyms and start your adventure today
    </p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center items-center">
      <a
        href="/search"
        class="inline-block bg-white text-sage px-8 py-4 rounded-lg font-bold text-lg hover:bg-gray-100 transition-colors"
      >
        Advanced Search
      </a>
      <a
        href="/guides"
        class="inline-block bg-transparent border-2 border-white text-white px-8 py-4 rounded-lg font-bold text-lg hover:bg-white/10 transition-colors"
      >
        Read Our Guides
      </a>
    </div>
  </section>
</BaseLayout>
