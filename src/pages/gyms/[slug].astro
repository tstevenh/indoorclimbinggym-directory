---
/**
 * Gym Detail Page
 * Dynamic page for each gym with rich content (800-1200 words) and full schema markup
 */
import BaseLayout from '../../layouts/BaseLayout.astro';
import GymCard from '../../components/GymCard.astro';
import CategoryLinks from '../../components/CategoryLinks.astro';
import HelpfulGuides from '../../components/HelpfulGuides.astro';
import OptimizedImage from '../../components/OptimizedImage.astro';
import GymMap from '../../components/GymMap.astro';
import SubredditCTA from '../../components/SubredditCTA.astro';
import AffiliateBlock from '../../components/AffiliateBlock.astro';
import { generateGymSchema, generateFAQSchema, serializeSchema } from '../../utils/schema';
import { generateGymTitle, generateGymDescription, generateGymKeywords } from '../../utils/seo';
import { IMAGE_SIZES } from '../../utils/imageUtils';
import { fetchGyms } from '../../config/api';
import { getStateSlug } from '../../utils/states';

export const prerender = true;

export async function getStaticPaths() {
  const gyms = await fetchGyms();

  return gyms.map(gym => ({
    params: { slug: gym.slug },
    props: {
      gym,
      allGyms: gyms, // Pass full dataset to avoid refetching
    },
  }));
}

const { gym, allGyms } = Astro.props;

// Parse pipe-delimited fields
const climbingTypes = gym.climbing_types?.split('|') || [];
const amenitiesList = gym.amenities?.split('|') || [];
const customAmenitiesList = gym.custom_amenities?.split('|').filter(Boolean) || [];
const trainingFacilities = gym.training_facilities?.split('|') || [];
const gearRental = gym.rental_equipment?.split('|') || [];

// Parse hours with day name mapping
const dayNameMap: Record<string, string> = {
  'mon': 'Monday',
  'tue': 'Tuesday',
  'wed': 'Wednesday',
  'thu': 'Thursday',
  'fri': 'Friday',
  'sat': 'Saturday',
  'sun': 'Sunday'
};

const hours = gym.working_hour?.split('|').map(entry => {
  const colonIndex = entry.indexOf(':');
  const dayShort = entry.substring(0, colonIndex).toLowerCase();
  const timeRange = entry.substring(colonIndex + 1);
  const [opens, closes] = timeRange.split('-');
  return {
    day: dayNameMap[dayShort] || dayShort.charAt(0).toUpperCase() + dayShort.slice(1),
    opens,
    closes
  };
}) || [];

// Get state slug for URL (e.g., "washington", "new-york")
const stateSlug = getStateSlug(gym.region);
const citySlug = gym.city.toLowerCase().replace(/\s+/g, '-');

// Build breadcrumbs
const breadcrumbs = [
  { label: 'Home', url: 'https://www.indoorclimbinggym.com/' },
  { label: gym.region, url: `https://www.indoorclimbinggym.com/${stateSlug}/` },
  { label: gym.city, url: `https://www.indoorclimbinggym.com/${stateSlug}/${citySlug}/1/` },
  { label: gym.name, url: `https://www.indoorclimbinggym.com/gyms/${gym.slug}/` },
];

// Helper to get the most interesting amenity for SEO
function getTopAmenity(amenities: string): string | undefined {
  const amenityList = amenities?.split('|') || [];
  const priorityAmenities = ['sauna', 'cafe', 'yoga', 'fitness', 'kids_zone'];
  for (const priority of priorityAmenities) {
    if (amenityList.includes(priority)) {
      return priority.replace(/_/g, ' ');
    }
  }
  return undefined;
}

// Generate SEO data with CTR-optimized parameters
const title = generateGymTitle(gym.name, gym.city, gym.region, gym.rating);
const description = generateGymDescription(
  gym.name,
  gym.city,
  climbingTypes,
  gym.rating,
  gym.day_pass_price_local,
  getTopAmenity(gym.amenities)
);
const keywords = generateGymKeywords(gym.name, gym.city, climbingTypes);
const pageUrl = `https://www.indoorclimbinggym.com/gyms/${gym.slug}`;

// Generate FAQ data
const faqs = [
  {
    question: `What types of climbing does ${gym.name} offer?`,
    answer: `${gym.name} offers ${climbingTypes.map(t => t.replace(/_/g, ' ')).join(', ')} climbing. ${gym.beginner_friendly ? 'The gym is beginner-friendly with routes for all skill levels.' : 'Routes range from beginner to advanced levels.'}`,
  },
  {
    question: `What are the hours of operation for ${gym.name}?`,
    answer: `${gym.name} is open ${hours[0]?.day} through ${hours[hours.length - 1]?.day}. Hours vary by day - check the schedule below for details.`,
  },
  {
    question: `How much is a day pass at ${gym.name}?`,
    answer: `A day pass at ${gym.name} costs $${gym.day_pass_price_local}. ${gym.student_discount ? 'Student discounts are available with valid ID.' : ''}`,
  },
  {
    question: `What amenities are available at ${gym.name}?`,
    answer: `${gym.name} features ${amenitiesList.slice(0, 5).map(a => a.replace(/_/g, ' ')).join(', ')}, and more. Check the full amenities list below.`,
  },
  {
    question: `Is ${gym.name} good for beginners?`,
    answer: gym.beginner_friendly
      ? `Yes! ${gym.name} is beginner-friendly with introductory classes, easy routes, and staff ready to help newcomers get started with climbing.`
      : `${gym.name} welcomes climbers of all levels. While not specifically marked as beginner-focused, the gym offers routes across various difficulty levels.`,
  },
];

// Generate schemas
const gymSchema = generateGymSchema(gym, pageUrl);
const faqSchema = generateFAQSchema(gym.faq && gym.faq.length > 0 ? gym.faq : faqs);
const combinedSchema = [gymSchema, faqSchema];

// Get related gyms from props (same city only)
// Note: allGyms is passed via props to avoid refetching (saves API calls)
let relatedGyms = allGyms
  .filter(g => g.city === gym.city && g.id !== gym.id)
  .slice(0, 3);
---

<BaseLayout
  title={title}
  description={description}
  keywords={keywords}
  schema={combinedSchema}
  breadcrumbs={breadcrumbs}
  ogImage={gym.photo}
>
  <div class="max-w-4xl mx-auto">
  <!-- Breadcrumb Navigation -->
  <nav class="text-sm text-gray-600 mb-6" aria-label="Breadcrumb">
    <ol class="flex items-center gap-2 flex-wrap">
      {breadcrumbs.map((crumb, index) => (
        <li class="flex items-center gap-2">
          {index > 0 && <span class="text-gray-400">/</span>}
          {index === breadcrumbs.length - 1 ? (
            <span class="text-granite font-medium">{crumb.label}</span>
          ) : (
            <a href={crumb.url} class="hover:text-sage">{crumb.label}</a>
          )}
        </li>
      ))}
    </ol>
  </nav>

  <!-- Hero Image -->
  <div class="relative h-64 md:h-96 rounded-t-lg overflow-hidden mb-0">
    <OptimizedImage
      src={gym.photo}
      alt={`${gym.name} climbing gym in ${gym.city}, ${gym.region}`}
      width={IMAGE_SIZES.HERO.width}
      height={IMAGE_SIZES.HERO.height}
      srcsetSizes={IMAGE_SIZES.HERO.sizes}
      sizes="100vw"
      quality={IMAGE_SIZES.HERO.quality}
      loading="eager"
      class="!absolute !inset-0 !h-full !aspect-auto [&>img]:!h-full"
    />
    {gym.featured && (
      <span class="absolute top-4 left-4 bg-sage text-white px-4 py-2 rounded-full font-medium shadow-lg z-10">
        Featured
      </span>
    )}
    {gym.beginner_friendly && (
      <span class="absolute top-4 right-4 bg-sage text-white px-4 py-2 rounded-full font-medium shadow-lg z-10">
        Beginner Friendly
      </span>
    )}
  </div>

  <!-- Hero Section with Essential Info -->
  <section class="bg-white rounded-b-lg shadow-lg px-6 pb-6 pt-4 md:px-8 md:pb-8 md:pt-6 mb-8">
    <!-- Title & Rating -->
    <header class="mb-6">
      <div class="flex items-start justify-between mb-3 flex-wrap gap-4">
        <div class="flex items-center gap-3 flex-wrap">
          <h1 class="text-4xl font-bold text-granite">{gym.name}</h1>
          {(gym.verified || gym.claimed) && (
            <span class="bg-sage text-white px-4 py-2 rounded-full text-sm font-medium">
              Verified
            </span>
          )}
        </div>

        <!-- Favorite Button (Right Side) -->
        <button
          id="favorite-btn"
          data-gym-id={gym.id}
          data-gym-slug={gym.slug}
          class="flex items-center gap-2 px-4 py-2 border-2 border-sage text-sage rounded-full hover:bg-sage transition-colors group"
          title="Save to favorites"
        >
          <svg id="favorite-icon" class="w-5 h-5 group-hover:stroke-white transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
          </svg>
          <span id="favorite-text" class="text-sm font-medium hidden sm:inline group-hover:text-white transition-colors">Save to Favorites</span>
        </button>
      </div>
      <div class="flex items-center gap-4 mb-6">
        <div class="flex flex-wrap items-center gap-2">
            {Array.from({ length: 5 }).map((_, i) => (
              <svg
                class={`w-5 h-5 flex-shrink-0 ${i < Math.floor(gym.rating_overall || gym.rating || 0) ? 'text-yellow-400' : 'text-gray-300'}`}
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
              </svg>
            ))}
            <span class="text-lg font-bold text-granite">
              {(gym.rating_overall || gym.rating || 0).toFixed(1)}
            </span>
          </div>
        </div>
      </header>

      <!-- Essential Contact Info Grid -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 pb-6 border-b border-gray-200 items-start">
        <!-- Address -->
        <div>
          <div class="flex items-center gap-2 text-gray-600 mb-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span class="text-sm font-semibold">Address</span>
          </div>
          <p class="text-gray-700 text-sm leading-relaxed">{gym.address}</p>
        </div>

        <!-- Phone -->
        <div>
          <div class="flex items-center gap-2 text-gray-600 mb-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
            </svg>
            <span class="text-sm font-semibold">Phone</span>
          </div>
          <a href={`tel:${gym.phone}`} class="text-sage font-medium text-sm leading-relaxed hover:underline inline-block">
            {gym.phone}
          </a>
        </div>

        <!-- Price -->
        <div>
          <div class="flex items-center gap-2 text-gray-600 mb-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span class="text-sm font-semibold">Day Pass</span>
          </div>
          <p class="text-gray-700 text-sm font-medium leading-relaxed">
            ${gym.day_pass_price_local || 'N/A'}
          </p>
        </div>
      </div>

      <!-- Action Buttons -->
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-3">
        <a
          href={gym.website}
          target="_blank"
          rel="noopener noreferrer"
          class="block w-full bg-sage text-white text-center py-3 rounded-lg font-medium hover:bg-opacity-90 transition-colors"
        >
          Visit Website
        </a>
        <a
          href={gym.google_maps_url || `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(gym.address)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="block w-full bg-white border-2 border-sage text-sage text-center py-3 rounded-lg font-medium hover:bg-sage/10 transition-colors"
        >
          Get Directions
        </a>
        {!gym.claimed && gym.status === 'published' && (
          <button
            id="claim-listing-btn"
            class="block w-full bg-white border-2 border-sage text-sage text-center py-3 rounded-lg font-medium hover:bg-sage hover:!text-white transition-colors"
          >
            Claim This Listing
          </button>
        )}
      </div>
    </section>

    <!-- Main Content (Single Column) -->
    <div class="space-y-8">
      <p class="text-xl text-gray-700 leading-relaxed">{gym.description_long}</p>

      <!-- About Section -->
      <section class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-granite mb-4">About {gym.name}</h2>
        <div class="prose max-w-none">
          {gym.about ? (
            <!-- Use custom about text if available -->
            <p class="text-gray-700 leading-relaxed whitespace-pre-line">{gym.about}</p>
          ) : (
            <!-- Fallback to templated content -->
            <>
              <p class="text-gray-700 leading-relaxed mb-4">
                Located in {gym.city}, {gym.region}, {gym.name} is a premier indoor climbing facility offering
                world-class climbing experiences for enthusiasts of all skill levels. {gym.beginner_friendly
                  ? 'Whether you\'re just starting your climbing journey or you\'re a seasoned climber, our facility welcomes everyone with open arms.'
                  : 'Our facility caters to climbers looking to push their limits and improve their skills.'}
              </p>
              <p class="text-gray-700 leading-relaxed mb-4">
                The gym features {climbingTypes.map(t => t.replace(/_/g, ' ')).join(', ')} climbing across
                {gym.total_routes || 'numerous'} routes and problems. With walls reaching up to {gym.wall_height_meters}
                meters high, climbers can experience everything from technical boulder problems to challenging lead routes.
              </p>
              <p class="text-gray-700 leading-relaxed">
                {gym.crowd_peak_notes ? `Pro tip: ${gym.crowd_peak_notes}` : `Visit during off-peak hours for the best climbing experience.`}
              </p>
            </>
          )}
        </div>
      </section>

      <!-- Hours of Operation -->
      <section class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-granite mb-4">Hours of Operation</h2>
        <div class="space-y-3">
          {hours.map((day) => (
            <div class="flex justify-between items-center py-3 px-4 rounded-lg bg-gray-50">
              <span class="font-medium text-granite">
                {day.day}
              </span>
              <span class="text-gray-700">
                {day.opens} - {day.closes}
              </span>
            </div>
          ))}
        </div>
        <p class="text-sm text-gray-600 mt-4">
          * Hours may vary on holidays. Please call ahead to confirm.
        </p>
      </section>

      <!-- Why Climbers Like It Section -->
      {gym.why_climbers_like_it && gym.why_climbers_like_it.length > 0 && (
        <section class="bg-sage/5 rounded-lg shadow-md p-6 border-l-4 border-sage">
          <h2 class="text-2xl font-bold text-granite mb-4">
            Why Climbers Love {gym.name}
          </h2>
          <ul class="space-y-3">
            {gym.why_climbers_like_it.map((reason: string) => (
              <li class="flex items-start gap-3">
                <svg class="w-6 h-6 text-sage flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                </svg>
                <span class="text-gray-700 leading-relaxed text-lg">{reason}</span>
              </li>
            ))}
          </ul>
        </section>
      )}

      <!-- Rating Breakdown - Only show if detailed ratings exist -->
      {(gym.rating_route_quality > 0 || gym.rating_cleanliness > 0) && (
        <section class="bg-gray-50 rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold text-granite mb-4">Our Expert Evaluation</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            {gym.rating_route_quality > 0 && (
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Route Quality:</span>
                <div class="flex items-center gap-1">
                  {Array.from({ length: 5 }).map((_, i) => {
                    const rating = gym.rating_route_quality;
                    const fillPercentage = Math.min(100, Math.max(0, (rating - i) * 100));

                    return (
                      <svg class="w-4 h-4" viewBox="0 0 20 20">
                        <defs>
                          <linearGradient id={`star-gradient-route-${i}`}>
                            <stop offset={`${fillPercentage}%`} stop-color="#FCD34D" />
                            <stop offset={`${fillPercentage}%`} stop-color="#D1D5DB" />
                          </linearGradient>
                        </defs>
                        <path
                          fill={`url(#star-gradient-route-${i})`}
                          d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                        />
                      </svg>
                    )
                  })}
                  <span class="text-sm font-medium text-granite ml-1">{gym.rating_route_quality.toFixed(1)}</span>
                </div>
              </div>
            )}
            {gym.rating_cleanliness > 0 && (
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Cleanliness:</span>
                <div class="flex items-center gap-1">
                  {Array.from({ length: 5 }).map((_, i) => {
                    const rating = gym.rating_cleanliness;
                    const fillPercentage = Math.min(100, Math.max(0, (rating - i) * 100));

                    return (
                      <svg class="w-4 h-4" viewBox="0 0 20 20">
                        <defs>
                          <linearGradient id={`star-gradient-clean-${i}`}>
                            <stop offset={`${fillPercentage}%`} stop-color="#FCD34D" />
                            <stop offset={`${fillPercentage}%`} stop-color="#D1D5DB" />
                          </linearGradient>
                        </defs>
                        <path
                          fill={`url(#star-gradient-clean-${i})`}
                          d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                        />
                      </svg>
                    )
                  })}
                  <span class="text-sm font-medium text-granite ml-1">{gym.rating_cleanliness.toFixed(1)}</span>
                </div>
              </div>
            )}
            {gym.rating_staff_friendliness > 0 && (
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Staff Friendliness:</span>
                <div class="flex items-center gap-1">
                  {Array.from({ length: 5 }).map((_, i) => {
                    const rating = gym.rating_staff_friendliness;
                    const fillPercentage = Math.min(100, Math.max(0, (rating - i) * 100));

                    return (
                      <svg class="w-4 h-4" viewBox="0 0 20 20">
                        <defs>
                          <linearGradient id={`star-gradient-staff-${i}`}>
                            <stop offset={`${fillPercentage}%`} stop-color="#FCD34D" />
                            <stop offset={`${fillPercentage}%`} stop-color="#D1D5DB" />
                          </linearGradient>
                        </defs>
                        <path
                          fill={`url(#star-gradient-staff-${i})`}
                          d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                        />
                      </svg>
                    )
                  })}
                  <span class="text-sm font-medium text-granite ml-1">{gym.rating_staff_friendliness.toFixed(1)}</span>
                </div>
              </div>
            )}
            {gym.rating_facilities > 0 && (
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Facilities:</span>
                <div class="flex items-center gap-1">
                  {Array.from({ length: 5 }).map((_, i) => {
                    const rating = gym.rating_facilities;
                    const fillPercentage = Math.min(100, Math.max(0, (rating - i) * 100));

                    return (
                      <svg class="w-4 h-4" viewBox="0 0 20 20">
                        <defs>
                          <linearGradient id={`star-gradient-facilities-${i}`}>
                            <stop offset={`${fillPercentage}%`} stop-color="#FCD34D" />
                            <stop offset={`${fillPercentage}%`} stop-color="#D1D5DB" />
                          </linearGradient>
                        </defs>
                        <path
                          fill={`url(#star-gradient-facilities-${i})`}
                          d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                        />
                      </svg>
                    )
                  })}
                  <span class="text-sm font-medium text-granite ml-1">{gym.rating_facilities.toFixed(1)}</span>
                </div>
              </div>
            )}
            {gym.rating_value_for_money > 0 && (
              <div class="flex justify-between items-center">
                <span class="text-gray-600">Value for Money:</span>
                <div class="flex items-center gap-1">
                  {Array.from({ length: 5 }).map((_, i) => {
                    const rating = gym.rating_value_for_money;
                    const fillPercentage = Math.min(100, Math.max(0, (rating - i) * 100));

                    return (
                      <svg class="w-4 h-4" viewBox="0 0 20 20">
                        <defs>
                          <linearGradient id={`star-gradient-value-${i}`}>
                            <stop offset={`${fillPercentage}%`} stop-color="#FCD34D" />
                            <stop offset={`${fillPercentage}%`} stop-color="#D1D5DB" />
                          </linearGradient>
                        </defs>
                        <path
                          fill={`url(#star-gradient-value-${i})`}
                          d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                        />
                      </svg>
                    )
                  })}
                  <span class="text-sm font-medium text-granite ml-1">{gym.rating_value_for_money.toFixed(1)}</span>
                </div>
              </div>
            )}

            <!-- Overall Average - Outstanding Display -->
            <div class="col-span-full mt-6 pt-6 border-t-2 border-sage/20">
              <div class="bg-sage/10 rounded-lg p-4 sm:p-6 border-l-4 border-sage">
                <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                  <div class="flex-1">
                    <p class="text-sm font-semibold text-gray-600 uppercase tracking-wide mb-2">Overall Rating</p>
                    <div class="flex items-center gap-2 sm:gap-3 flex-wrap">
                      {/* Show 5 stars with gradient fill for overall rating */}
                      <div class="flex items-center gap-1">
                        {Array.from({ length: 5 }).map((_, i) => {
                          const rating = gym.rating_overall;
                          const fillPercentage = Math.min(100, Math.max(0, (rating - i) * 100));

                          return (
                            <svg class="w-6 h-6 sm:w-8 sm:h-8" viewBox="0 0 20 20">
                              <defs>
                                <linearGradient id={`star-gradient-overall-${i}`}>
                                  <stop offset={`${fillPercentage}%`} stop-color="#FCD34D" />
                                  <stop offset={`${fillPercentage}%`} stop-color="#D1D5DB" />
                                </linearGradient>
                              </defs>
                              <path
                                fill={`url(#star-gradient-overall-${i})`}
                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"
                              />
                            </svg>
                          )
                        })}
                      </div>
                      <span class="text-3xl sm:text-4xl font-bold text-sage">{gym.rating_overall.toFixed(1)}</span>
                      <span class="text-gray-500 text-base sm:text-lg">/ 5.0</span>
                    </div>
                  </div>
                  <div class="text-left sm:text-right">
                    <p class="text-xs text-gray-500 uppercase tracking-wide">Based on</p>
                    <p class="text-xl sm:text-2xl font-bold text-granite whitespace-nowrap">5 Categories</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-4 italic border-t border-gray-200 pt-4">
            We evaluate climbing gyms using detailed ratings across route quality, cleanliness, staff friendliness, facilities, and value. Ratings are based on climber reviews, expert assessments, and facility inspections.
          </p>
        </section>
      )}

      <!-- Climbing Types & Grades -->
      <section class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-granite mb-4">Climbing Types & Grades</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="font-semibold text-granite mb-3">Available Climbing Styles</h3>
            <ul class="space-y-2">
              {climbingTypes.map(type => (
                <li class="flex items-center gap-2">
                  <svg class="w-5 h-5 text-sage" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="capitalize">{type.replace(/_/g, ' ')}</span>
                </li>
              ))}
            </ul>
          </div>
          <div>
            <h3 class="font-semibold text-granite mb-3">Grading Systems</h3>
            <p class="text-gray-700 mb-2">
              <strong>Grade System:</strong> {gym.difficulty_grades?.replace(/\|/g, ', ') || 'N/A'}
            </p>
            <p class="text-gray-700 mb-2">
              <strong>Total Routes:</strong> {gym.total_routes || 'N/A'} problems/routes
            </p>
            <p class="text-gray-700 mb-4">
              <strong>Route Setting:</strong> Routes reset {gym.route_reset_frequency || 'regularly'}
            </p>

            <!-- Grade Converter Links -->
            <div class="bg-ivory rounded-lg p-4 border-l-4 border-sage">
              <p class="text-sm font-semibold text-granite mb-2">Not sure what these grades mean?</p>
              <div class="flex flex-wrap gap-2">
                <a
                  href="/tools/bouldering-grade-conversion"
                  class="inline-flex items-center gap-1 text-xs bg-sage text-white px-3 py-1.5 rounded-full hover:bg-sage/90 transition-colors"
                >
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  <span>Bouldering Converter</span>
                </a>
                <a
                  href="/tools/sport-climbing-grade-conversion"
                  class="inline-flex items-center gap-1 text-xs bg-sage text-white px-3 py-1.5 rounded-full hover:bg-sage/90 transition-colors"
                >
                  <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                  </svg>
                  <span>Sport Climbing Converter</span>
                </a>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Amenities -->
      <section class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-granite mb-4">Amenities & Facilities</h2>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          {amenitiesList.map(amenity => (
            <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
              <svg class="w-5 h-5 text-sage flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
              </svg>
              <span class="text-sm">{amenity.replace(/_/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</span>
            </div>
          ))}
        </div>

        {trainingFacilities.length > 0 && (
          <div class="mt-6">
            <h3 class="font-semibold text-granite mb-3">Training Facilities</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              {trainingFacilities.map(facility => (
                <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
                  <svg class="w-5 h-5 text-sage flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm">
                    {facility.replace(/_/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}
                  </span>
                </div>
              ))}
            </div>
          </div>
        )}

        {gearRental.length > 0 && (
          <div class="mt-6">
            <h3 class="font-semibold text-granite mb-3">Gear Rental Available</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              {gearRental.map(gear => (
                <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
                  <svg class="w-5 h-5 text-sage flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm">
                    {gear.replace(/_/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}
                  </span>
                </div>
              ))}
            </div>
          </div>
        )}

        {customAmenitiesList.length > 0 && (
          <div class="mt-6 pt-6 border-t border-gray-200">
            <h3 class="font-semibold text-granite mb-4">Additional Amenities</h3>
            <div class="flex flex-wrap gap-2">
              {customAmenitiesList.map(amenity => (
                <div class="inline-flex items-center gap-2 px-4 py-2 bg-white border-2 border-sage rounded-full">
                  <svg class="w-4 h-4 text-sage flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                  </svg>
                  <span class="text-sm font-medium text-granite">{amenity.replace(/_/g, ' ').split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ')}</span>
                </div>
              ))}
            </div>
          </div>
        )}
      </section>

      {/* Affiliate Gear Block - Monetization */}
      <AffiliateBlock 
        title="Recommended Climbing Gear"
        subtitle="Don't want to rent? Here is the gear we recommend for gym climbing."
      />

      <!-- Pricing - Only show if pricing data exists -->
      {(gym.day_pass_price_local || gym.membership_from_local) && (
        <section class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold text-granite mb-4">Pricing</h2>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead>
                <tr class="border-b-2 border-gray-200">
                  <th class="text-left py-3 px-4 font-semibold text-granite">Pass Type</th>
                  <th class="text-left py-3 px-4 font-semibold text-granite">Price</th>
                  <th class="text-left py-3 px-4 font-semibold text-granite">Details</th>
                </tr>
              </thead>
              <tbody>
                {gym.day_pass_price_local && (
                  <tr class="border-b border-gray-100">
                    <td class="py-3 px-4">Day Pass</td>
                    <td class="py-3 px-4 font-bold text-sage">${gym.day_pass_price_local}</td>
                    <td class="py-3 px-4 text-sm text-gray-600">Valid for one day</td>
                  </tr>
                )}
                {gym.membership_from_local && (
                  <tr class="border-b border-gray-100">
                    <td class="py-3 px-4">Monthly Membership</td>
                    <td class="py-3 px-4 font-bold text-sage">From ${gym.membership_from_local}/mo</td>
                    <td class="py-3 px-4 text-sm text-gray-600">Unlimited access</td>
                  </tr>
                )}
                {gym.student_discount && (
                  <tr class="border-b border-gray-100">
                    <td class="py-3 px-4">Student Discount</td>
                    <td class="py-3 px-4 font-bold text-sage">Available</td>
                    <td class="py-3 px-4 text-sm text-gray-600">Valid student ID required</td>
                  </tr>
                )}
              </tbody>
            </table>
          </div>
          <p class="text-sm text-gray-600 mt-4">
            * Prices subject to change. Contact {gym.name} directly for current rates and membership options.
          </p>
        </section>
      )}

      <!-- Cost Calculator CTA -->
      <div class="calculator-cta mt-8 p-6 bg-sage/5 border-2 border-sage/20 rounded-xl text-center">
        <h3 class="text-xl font-bold text-granite mb-2">
          Wondering if a membership is worth it?
        </h3>
        <p class="text-gray-700 mb-4">
          Use our free calculator to compare day passes vs membership based on how often you climb.
        </p>
        <a
          href="/tools/cost-per-climb-calculator"
          class="inline-flex items-center justify-center px-6 py-3 bg-sage text-white font-bold rounded-lg hover:bg-sage/90 transition-all shadow-lg"
        >
          Calculate Your Cost Per Climb â†’
        </a>
      </div>

      <!-- FAQ Section -->
      <section class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-granite mb-6">Frequently Asked Questions</h2>
        <div class="space-y-6">
          {(gym.faq && gym.faq.length > 0 ? gym.faq : faqs).map((faq: any, index: number) => (
            <div class="border-b border-gray-200 pb-6 last:border-0 last:pb-0">
              <h3 class="font-semibold text-granite mb-2">{faq.question}</h3>
              <p class="text-gray-700">{faq.answer}</p>
            </div>
          ))}
        </div>
      </section>

      <!-- Discover Similar Categories -->
      <CategoryLinks gym={gym} />

      <!-- Full-Width Interactive Map -->
      {gym.latitude && gym.longtitude && gym.latitude !== 0 && gym.longtitude !== 0 && (
        <section class="bg-white rounded-lg shadow-md p-6">
          <h2 class="text-2xl font-bold text-granite mb-4">Location</h2>
          <div class="h-96">
            <GymMap
              latitude={gym.latitude}
              longitude={gym.longtitude}
              gymName={gym.name}
              address={gym.address}
            />
          </div>
          {gym.access_notes && (
            <p class="text-sm text-gray-600 mt-4">{gym.access_notes}</p>
          )}
        </section>
      )}

      <!-- Subreddit Community CTA -->
      <SubredditCTA variant="gym" />

      <!-- Helpful Guides -->
      <HelpfulGuides beginner_friendly={gym.beginner_friendly} />
    </div>

  <!-- Related Gyms Section -->
  {relatedGyms.length > 0 && (
    <section class="mt-12">
      <h2 class="text-3xl font-bold text-granite mb-6">
        Other Climbing Gyms in {gym.city}
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        {relatedGyms.map(relatedGym => (
          <GymCard gym={relatedGym} showCity={relatedGym.city !== gym.city} />
        ))}
      </div>
    </section>
  )}

  {/* Claim Listing Modal */}
  {!gym.claimed && gym.status === 'published' && (
    <div id="claim-modal" class="hidden fixed inset-0 backdrop-blur-sm z-50 flex items-center justify-center p-4">
      <div class="bg-white rounded-lg max-w-md w-full p-6 relative border-t-4 border-sage shadow-2xl">
        {/* Close Button */}
        <button id="close-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>

        {/* Modal Content */}
        <h2 class="text-2xl font-bold text-granite mb-4">Claim this gym</h2>
        <div class="space-y-4 mb-6">
          <p class="text-gray-700">
            Own or manage this gym? Claim your listing to update hours, pricing, photos, and mark it as Verified.
          </p>
          <p class="text-gray-700">
            You'll just need a work email (like name@yourgym.com).
          </p>
        </div>

        {/* CTA Button */}
        <div class="flex gap-3">
          <button id="maybe-later" class="flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
            Maybe Later
          </button>
          <a
            href={`${import.meta.env.PUBLIC_DASHBOARD_URL}/dashboard/claim-listing?gym_id=${gym.id}`}
            class="flex-1 px-4 py-3 bg-sage text-white text-center rounded-lg font-medium hover:bg-opacity-90 transition-colors"
          >
            Continue to Claim
          </a>
        </div>
      </div>
    </div>
  )}

  {/* Modal Script */}
  {!gym.claimed && gym.status === 'published' && (
    <script>
      const claimBtn = document.getElementById('claim-listing-btn');
      const modal = document.getElementById('claim-modal');
      const closeBtn = document.getElementById('close-modal');
      const maybeLaterBtn = document.getElementById('maybe-later');

      claimBtn?.addEventListener('click', () => {
        modal?.classList.remove('hidden');
      });

      closeBtn?.addEventListener('click', () => {
        modal?.classList.add('hidden');
      });

      maybeLaterBtn?.addEventListener('click', () => {
        modal?.classList.add('hidden');
      });

      // Close on outside click
      modal?.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.add('hidden');
        }
      });

      // Close on Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
          modal.classList.add('hidden');
        }
      });
    </script>
  )}

  {/* Favorite Button Script */}
  <script define:vars={{
    dashboardUrl: import.meta.env.PUBLIC_DASHBOARD_URL,
    supabaseUrl: import.meta.env.PUBLIC_SUPABASE_URL,
    supabaseKey: import.meta.env.PUBLIC_SUPABASE_ANON_KEY
  }}>
    (async function() {
      const favoriteBtn = document.getElementById('favorite-btn');
      const favoriteIcon = document.getElementById('favorite-icon');
      const favoriteText = document.getElementById('favorite-text');

      if (!favoriteBtn) return;

      const gymId = favoriteBtn.dataset.gymId;
      const gymSlug = favoriteBtn.dataset.gymSlug;
      let isFavorited = false;
      let userId = null;

      // Get auth cookie
      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return null;
      }

      // Check if user is logged in by checking for auth cookie
      const authCookie = getCookie(`sb-${supabaseUrl.split('//')[1].split('.')[0]}-auth-token`);

      if (!authCookie) {
        // Not logged in - redirect to login on click
        favoriteBtn.addEventListener('click', (e) => {
          e.preventDefault();
          window.location.href = `${dashboardUrl}/login?redirectTo=${encodeURIComponent(`${window.location.origin}/gyms/${gymSlug}`)}`;
        });
        return;
      }

      // User is logged in - check if gym is favorited
      try {
        const response = await fetch(`${dashboardUrl}/api/favorites/check?gym_id=${gymId}`, {
          credentials: 'include'
        });

        if (response.ok) {
          const data = await response.json();
          isFavorited = data.isFavorited;
          userId = data.userId;

          // Update UI based on favorite status
          updateFavoriteUI();
        }
      } catch (error) {
        console.error('Error checking favorite status:', error);
      }

      function updateFavoriteUI() {
        if (isFavorited) {
          // Show filled heart with sage green
          favoriteIcon.setAttribute('fill', 'currentColor');
          favoriteIcon.classList.add('text-sage', 'group-hover:text-white');
          favoriteIcon.classList.remove('group-hover:stroke-white');
          favoriteText.textContent = 'In Your Favorites';
          favoriteBtn.title = 'Remove from favorites';
        } else {
          // Show empty heart
          favoriteIcon.setAttribute('fill', 'none');
          favoriteIcon.classList.remove('text-sage', 'group-hover:text-white');
          favoriteIcon.classList.add('group-hover:stroke-white');
          favoriteText.textContent = 'Save to Favorites';
          favoriteBtn.title = 'Save to favorites';
        }
      }

      // Handle favorite toggle
      favoriteBtn.addEventListener('click', async (e) => {
        e.preventDefault();
        e.stopPropagation();

        if (!userId) {
          window.location.href = `${dashboardUrl}/login?redirectTo=${encodeURIComponent(`${window.location.origin}/gyms/${gymSlug}`)}`;
          return;
        }

        favoriteBtn.disabled = true;

        try {
          const url = isFavorited
            ? `${dashboardUrl}/api/favorites/remove`
            : `${dashboardUrl}/api/favorites/add`;

          const response = await fetch(url, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ gym_id: gymId }),
            credentials: 'include'
          });

          if (response.ok) {
            isFavorited = !isFavorited;
            updateFavoriteUI();
          } else {
            alert('Failed to update favorites. Please try again.');
          }
        } catch (error) {
          console.error('Error toggling favorite:', error);
          alert('Something went wrong. Please try again.');
        } finally {
          favoriteBtn.disabled = false;
        }
      });
    })();
  </script>

  {/* Report Info Modal */}
  <div id="report-modal" class="hidden fixed inset-0 backdrop-blur-sm z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6 relative border-t-4 border-sage shadow-2xl">
      {/* Close Button */}
      <button id="close-report-modal" class="absolute top-4 right-4 text-gray-400 hover:text-gray-600">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      {/* Modal Content */}
      <h2 class="text-2xl font-bold text-granite mb-4">Report Incorrect Info</h2>
      <div class="space-y-4 mb-6">
        <p class="text-gray-700">
          To ensure data quality, we require users to login or register to report incorrect information.
        </p>
        <p class="text-gray-700">
           You will be redirected to our dashboard to submit your correction.
        </p>
      </div>

      {/* CTA Button */}
      <div class="flex gap-3">
        <button id="report-maybe-later" class="flex-1 px-4 py-3 border-2 border-gray-300 text-gray-700 rounded-lg font-medium hover:bg-gray-50 transition-colors">
          Maybe Later
        </button>
        <a
          href={`${import.meta.env.PUBLIC_DASHBOARD_URL}/corrections/submit?gym_id=${gym.id}&gym_name=${encodeURIComponent(gym.name)}`}
          target="_blank"
          rel="noopener noreferrer"
          class="flex-1 px-4 py-3 bg-sage text-white text-center rounded-lg font-medium hover:bg-opacity-90 transition-colors"
        >
          Login to Report
        </a>
      </div>
    </div>
  </div>

  {/* Report Modal Script */}
  <script>
    const reportBtn = document.getElementById('report-info-btn');
    const reportModal = document.getElementById('report-modal');
    const closeReportBtn = document.getElementById('close-report-modal');
    const reportMaybeLaterBtn = document.getElementById('report-maybe-later');

    reportBtn?.addEventListener('click', () => {
      reportModal?.classList.remove('hidden');
    });

    closeReportBtn?.addEventListener('click', () => {
      reportModal?.classList.add('hidden');
    });

    reportMaybeLaterBtn?.addEventListener('click', () => {
      reportModal?.classList.add('hidden');
    });

    // Close on outside click
    reportModal?.addEventListener('click', (e) => {
      if (e.target === reportModal) {
        reportModal.classList.add('hidden');
      }
    });

    // Close on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !reportModal?.classList.contains('hidden')) {
        reportModal.classList.add('hidden');
      }
    });
  </script>
  </div>

  <!-- Floating Report Incorrect Info Button -->
  <button
    id="report-info-btn"
    class="fixed bottom-6 right-6 bg-white border-2 border-sage text-sage px-4 py-3 rounded-full font-medium shadow-xl hover:shadow-2xl hover:bg-sage hover:!text-white transition-all duration-200 flex items-center gap-2 z-50"
    aria-label="Report incorrect gym information"
  >
    <span class="hidden sm:inline">Report Incorrect Info</span>
    <span class="sm:hidden">Report Error</span>
  </button>
</BaseLayout>
