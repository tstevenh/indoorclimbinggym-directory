---
/**
 * One-Time Welcome Modal
 * Shows once per visitor (localStorage tracking)
 * Appears after 5 seconds on first visit
 * No backend/API needed - 100% client-side
 */
---

<!-- Modal Backdrop & Container -->
<div id="welcome-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
  <div class="bg-white rounded-lg max-w-md w-full p-8 relative shadow-2xl">
    <!-- Close Button -->
    <button
      id="close-welcome-modal"
      class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"
      aria-label="Close modal"
    >
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>

    <!-- Modal Content -->
    <div class="text-center">
      <!-- Icon -->
      <div class="w-16 h-16 bg-sage/10 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-sage" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
      </div>

      <!-- Title -->
      <h2 class="text-2xl font-bold text-granite mb-3">
        Welcome to Our Climbing Community!
      </h2>

      <!-- Description -->
      <p class="text-gray-700 mb-6 leading-relaxed">
        Share tips, find climbing partners, and discuss routes with fellow climbers on our subreddit.
        Connect with the community today!
      </p>

      <!-- CTA Button -->
      <a
        href="https://reddit.com/r/indoorclimbinggym"
        target="_blank"
        rel="noopener noreferrer"
        class="inline-flex items-center gap-2 bg-sage text-white px-6 py-3 rounded-lg font-semibold hover:bg-sage/90 transition-colors shadow-md hover:shadow-lg mb-3 w-full justify-center"
      >
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
          <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
        </svg>
        Join r/indoorclimbinggym
      </a>

      <!-- Dismiss Link -->
      <button
        id="dismiss-welcome-modal"
        class="text-sm text-gray-500 hover:text-gray-700 transition-colors"
      >
        No thanks, maybe later
      </button>
    </div>
  </div>
</div>

<script>
  // localStorage key for tracking if modal has been seen
  const MODAL_SEEN_KEY = 'indoorClimbingWelcomeModalSeen';

  // Wait for DOM to be ready
  document.addEventListener('DOMContentLoaded', () => {
    // Check if user has already seen the modal
    const hasSeenModal = localStorage.getItem(MODAL_SEEN_KEY);

    if (!hasSeenModal) {
      // Show modal after 5 seconds (non-blocking delay)
      setTimeout(() => {
        showModal();
      }, 5000);
    }
  });

  function showModal() {
    const modal = document.getElementById('welcome-modal');
    if (modal) {
      modal.classList.remove('hidden');
      // Prevent body scroll when modal is open
      document.body.style.overflow = 'hidden';
    }
  }

  function closeModal() {
    const modal = document.getElementById('welcome-modal');
    if (modal) {
      modal.classList.add('hidden');
      // Restore body scroll
      document.body.style.overflow = '';
      // Save to localStorage so it never shows again
      localStorage.setItem(MODAL_SEEN_KEY, 'true');
    }
  }

  // Close button click
  const closeButton = document.getElementById('close-welcome-modal');
  if (closeButton) {
    closeButton.addEventListener('click', closeModal);
  }

  // Dismiss button click
  const dismissButton = document.getElementById('dismiss-welcome-modal');
  if (dismissButton) {
    dismissButton.addEventListener('click', closeModal);
  }

  // Close on backdrop click
  const modal = document.getElementById('welcome-modal');
  if (modal) {
    modal.addEventListener('click', (e) => {
      // Only close if clicking the backdrop (not the modal content)
      if (e.target === modal) {
        closeModal();
      }
    });
  }

  // Close on ESC key (accessibility)
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      const modal = document.getElementById('welcome-modal');
      if (modal && !modal.classList.contains('hidden')) {
        closeModal();
      }
    }
  });
</script>

<style>
  /* Smooth fade-in animation */
  #welcome-modal {
    animation: fadeIn 0.3s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }

  /* Modal content slides up slightly */
  #welcome-modal > div {
    animation: slideUp 0.3s ease-out;
  }

  @keyframes slideUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
</style>
