---
/**
 * BaseLayout
 * Foundation layout for all pages with comprehensive SEO meta tags and schema markup
 */
import '../styles/global.css';
import { fetchGyms } from '../config/api';
import { getStateCode, getStateSlug } from '../utils/states';
import SpeedInsights from '@vercel/speed-insights/astro';
import Analytics from '@vercel/analytics/astro';
import CookieConsent from '../components/CookieConsent.astro';

interface Props {
  title: string;
  description: string;
  canonical?: string;
  ogImage?: string;
  ogType?: 'website' | 'article';
  keywords?: string[];
  noindex?: boolean;
  nofollow?: boolean;
  schema?: any; // JSON-LD schema object(s)
  breadcrumbs?: Array<{ label: string; url: string }>;
  prevUrl?: string; // URL to previous page (for pagination)
  nextUrl?: string; // URL to next page (for pagination)
  // Article-specific meta tags (for blog posts)
  articlePublishedTime?: string;
  articleModifiedTime?: string;
  articleAuthor?: string;
  articleSection?: string;
  articleTags?: string[];
}

const {
  title,
  description,
  canonical,
  ogImage = 'https://www.indoorclimbinggym.com/og-default.jpg',
  ogType = 'website',
  keywords = [],
  noindex = false,
  nofollow = false,
  schema,
  breadcrumbs,
  prevUrl,
  nextUrl,
  articlePublishedTime,
  articleModifiedTime,
  articleAuthor,
  articleSection,
  articleTags,
} = Astro.props;

// Fetch gyms to calculate top 5 states dynamically
const gymsData = await fetchGyms();

// Count gyms by state (normalize to full name)
const stateCounts: Record<string, number> = {};
gymsData.forEach(gym => {
  const region = gym.region?.trim();
  if (region) {
    // Use the region as-is (it's already the full state name)
    stateCounts[region] = (stateCounts[region] || 0) + 1;
  }
});

// Sort by count DESC and take top 5
const top5States = Object.entries(stateCounts)
  .sort(([,a], [,b]) => b - a)
  .slice(0, 5);

// Count gyms by city
const cityCounts: Record<string, { count: number; city: string; region: string; slug: string }> = {};
gymsData.forEach(gym => {
  const city = gym.city?.trim();
  const region = gym.region?.trim();
  if (city && region) {
    const key = `${city}, ${region}`;
    if (!cityCounts[key]) {
      cityCounts[key] = {
        count: 0,
        city,
        region,
        slug: city.toLowerCase().replace(/\s+/g, '-')
      };
    }
    cityCounts[key].count++;
  }
});

// Sort cities by count DESC and take top 5
const top5Cities = Object.values(cityCounts)
  .sort((a, b) => b.count - a.count)
  .slice(0, 5);

// Build canonical URL
const siteUrl = 'https://www.indoorclimbinggym.com';
const canonicalURL = canonical || new URL(Astro.url.pathname, siteUrl).href;

// Ensure title is under 60 characters
const finalTitle = title.length > 60 ? title.substring(0, 57) + '...' : title;

// Ensure description is under 160 characters
const finalDescription =
  description.length > 160 ? description.substring(0, 157) + '...' : description;

// Construct robots meta
const robotsDirectives = [];
if (noindex) robotsDirectives.push('noindex');
if (nofollow) robotsDirectives.push('nofollow');
const robots =
  robotsDirectives.length > 0 ? robotsDirectives.join(', ') : 'index, follow';

// Generate breadcrumb schema if provided
let breadcrumbSchema = null;
if (breadcrumbs && breadcrumbs.length > 0) {
  breadcrumbSchema = {
    '@context': 'https://schema.org',
    '@type': 'BreadcrumbList',
    itemListElement: breadcrumbs.map((crumb, index) => ({
      '@type': 'ListItem',
      position: index + 1,
      name: crumb.label,
      item: crumb.url,
    })),
  };
}
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="generator" content={Astro.generator} />

    <!-- Primary Meta Tags -->
    <title>{finalTitle}</title>
    <meta name="title" content={finalTitle} />
    <meta name="description" content={finalDescription} />
    {keywords.length > 0 && <meta name="keywords" content={keywords.join(', ')} />}
    <meta name="robots" content={robots} />

    <!-- Google Search Console Verification -->
    <meta name="google-site-verification" content="T-zPHFE-oDE3mQ2g5Fqn4IwfQZUUFOjOAJIC7cIAP7U" />

    <!-- Canonical URL -->
    <link rel="canonical" href={canonicalURL} />

    <!-- Pagination Links (SEO) -->
    {prevUrl && <link rel="prev" href={prevUrl} />}
    {nextUrl && <link rel="next" href={nextUrl} />}

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content={ogType} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:title" content={finalTitle} />
    <meta property="og:description" content={finalDescription} />
    <meta property="og:image" content={ogImage} />
    <meta property="og:site_name" content="IndoorClimbingGym" />

    <!-- Article-specific Open Graph tags -->
    {ogType === 'article' && articlePublishedTime && <meta property="article:published_time" content={articlePublishedTime} />}
    {ogType === 'article' && articleModifiedTime && <meta property="article:modified_time" content={articleModifiedTime} />}
    {ogType === 'article' && articleAuthor && <meta property="article:author" content={articleAuthor} />}
    {ogType === 'article' && articleSection && <meta property="article:section" content={articleSection} />}
    {ogType === 'article' && articleTags && articleTags.map(tag => <meta property="article:tag" content={tag} />)}

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content={canonicalURL} />
    <meta property="twitter:title" content={finalTitle} />
    <meta property="twitter:description" content={finalDescription} />
    <meta property="twitter:image" content={ogImage} />

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/logo.svg" />
    <link rel="apple-touch-icon" sizes="180x180" href="/logo.svg" />

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://images.unsplash.com" />
    <link rel="preconnect" href="https://www.googletagmanager.com" />
    <link rel="dns-prefetch" href="https://www.google-analytics.com" />

    <!-- JSON-LD Structured Data -->
    {Array.isArray(schema)
      ? schema.map((s) => (
          <script type="application/ld+json" set:html={JSON.stringify(s)} />
        ))
      : schema && <script type="application/ld+json" set:html={JSON.stringify(schema)} />}
    {
      breadcrumbSchema && (
        <script
          type="application/ld+json"
          set:html={JSON.stringify(breadcrumbSchema)}
        />
      )
    }

    <!-- Vercel Speed Insights -->
    <SpeedInsights />

    <!-- Vercel Web Analytics -->
    <Analytics />

    <!-- Google Analytics (Consent-controlled) -->
    <!-- Script loaded conditionally by CookieConsent component after user consent -->
    <script is:inline>
      // Initialize dataLayer for consent management
      window.dataLayer = window.dataLayer || [];
      window.gtag = function() { dataLayer.push(arguments); };

      // Default to no consent until user accepts
      gtag('consent', 'default', {
        'analytics_storage': 'denied',
        'ad_storage': 'denied'
      });
    </script>

    <!-- GA script tag (will be enabled if analytics consent is given) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-KQJE0F08ER"></script>
    <script is:inline>
      gtag('config', 'G-KQJE0F08ER');
    </script>
  </head>
  <body class="min-h-screen bg-ivory text-granite antialiased">
    <!-- Skip to main content link for accessibility -->
    <a
      href="#main-content"
      class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-sage focus:text-white focus:px-4 focus:py-2 focus:rounded"
    >
      Skip to main content
    </a>

  <!-- Header will go here -->
    <header class="bg-white shadow-sm">
      <div class="container mx-auto px-4 py-4">
        <nav class="flex items-center justify-between">
          <a href="/" class="text-2xl font-bold text-sage">
            IndoorClimbingGym
          </a>

          <!-- Desktop Navigation -->
          <div class="hidden md:flex items-center gap-6">
            <a href="/search" class="text-granite hover:text-sage transition-colors">Search</a>

            <!-- Categories Dropdown -->
            <div class="relative group">
              <button class="flex items-center gap-1 text-granite hover:text-sage transition-colors cursor-pointer">
                Categories
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="py-2">
                  <a href="/categories/best-bouldering-climbing-gyms/1" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    Best Bouldering Gyms
                  </a>
                  <a href="/categories/best-climbing-gyms-for-beginners/1" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    For Beginners
                  </a>
                  <a href="/categories/affordable-climbing-gyms/1" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    Affordable Gyms
                  </a>
                  <a href="/categories/climbing-gyms-with-sauna/1" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    With Sauna
                  </a>
                  <a href="/categories/climbing-gyms-with-kids-zone/1" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    With Kids Zone
                  </a>
                  <div class="border-t border-gray-200 my-1"></div>
                  <a href="/categories" class="block px-4 py-2 text-sm text-gray-500 hover:bg-sage/10 hover:text-sage transition-colors">
                    View All Categories →
                  </a>
                </div>
              </div>
            </div>

            <!-- States Dropdown -->
            <div class="relative group">
              <button class="flex items-center gap-1 text-granite hover:text-sage transition-colors cursor-pointer">
                States
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="absolute left-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="py-2">
                  {top5States.map(([stateName]) => {
                    const stateSlug = getStateSlug(stateName);
                    return (
                      <a
                        href={`/${stateSlug}`}
                        class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors"
                      >
                        {stateName}
                      </a>
                    );
                  })}
                  <div class="border-t border-gray-200 my-1"></div>
                  <a href="/states" class="block px-4 py-2 text-sm text-gray-500 hover:bg-sage/10 hover:text-sage transition-colors">
                    View All States →
                  </a>
                </div>
              </div>
            </div>

            <a href="/blog" class="text-granite hover:text-sage transition-colors">Blog</a>
            <a href="/about" class="text-granite hover:text-sage transition-colors">About</a>

            <!-- Auth Nav: Populated by client-side script -->
            <div id="desktop-auth-nav" class="flex items-center gap-4">
              <!-- Loading placeholder -->
              <div class="text-gray-400 text-sm">•••</div>
            </div>
          </div>

          <!-- Mobile Hamburger Button -->
          <button
            id="mobile-menu-button"
            type="button"
            class="md:hidden p-2 text-granite hover:text-sage transition-colors"
            aria-label="Open menu"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </nav>
      </div>
    </header>

    <!-- Main content area -->
    <main id="main-content" class="container mx-auto px-4 py-8">
      <slot />
    </main>

    <!-- Footer will go here -->
    <footer class="bg-granite text-ivory mt-16">
      <div class="container mx-auto px-4 py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8">
          <!-- Column 1: Brand + Social -->
          <div>
            <h3 class="font-bold text-lg mb-4">IndoorClimbingGym</h3>
            <p class="text-sm mb-4">Find Your Next Climb.</p>

            <!-- Social Media -->
            <div class="flex gap-4">
              <a href="https://reddit.com/r/indoorclimbinggym" target="_blank" rel="noopener noreferrer" class="text-ivory hover:text-sage transition-colors" aria-label="Join our Reddit community">
                <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path d="M12 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0zm5.01 4.744c.688 0 1.25.561 1.25 1.249a1.25 1.25 0 0 1-2.498.056l-2.597-.547-.8 3.747c1.824.07 3.48.632 4.674 1.488.308-.309.73-.491 1.207-.491.968 0 1.754.786 1.754 1.754 0 .716-.435 1.333-1.01 1.614a3.111 3.111 0 0 1 .042.52c0 2.694-3.13 4.87-7.004 4.87-3.874 0-7.004-2.176-7.004-4.87 0-.183.015-.366.043-.534A1.748 1.748 0 0 1 4.028 12c0-.968.786-1.754 1.754-1.754.463 0 .898.196 1.207.49 1.207-.883 2.878-1.43 4.744-1.487l.885-4.182a.342.342 0 0 1 .14-.197.35.35 0 0 1 .238-.042l2.906.617a1.214 1.214 0 0 1 1.108-.701zM9.25 12C8.561 12 8 12.562 8 13.25c0 .687.561 1.248 1.25 1.248.687 0 1.248-.561 1.248-1.249 0-.688-.561-1.249-1.249-1.249zm5.5 0c-.687 0-1.248.561-1.248 1.25 0 .687.561 1.248 1.249 1.248.688 0 1.249-.561 1.249-1.249 0-.687-.562-1.249-1.25-1.249zm-5.466 3.99a.327.327 0 0 0-.231.094.33.33 0 0 0 0 .463c.842.842 2.484.913 2.961.913.477 0 2.105-.056 2.961-.913a.361.361 0 0 0 .029-.463.33.33 0 0 0-.464 0c-.547.533-1.684.73-2.512.73-.828 0-1.979-.196-2.512-.73a.326.326 0 0 0-.232-.095z"/>
                </svg>
              </a>
            </div>
          </div>

          <!-- Column 2: Explore -->
          <div>
            <h4 class="font-semibold mb-3">Explore</h4>
            <ul class="space-y-2 text-sm">
              <li><a href="/search" class="hover:text-sage">Search Gyms</a></li>
              <li><a href="/tools" class="hover:text-sage">Grade Converters</a></li>
              <li><a href="/blog" class="hover:text-sage">Blog</a></li>
              <li><a href="/studies" class="hover:text-sage">Studies</a></li>
            </ul>
          </div>

          <!-- Column 3: Top Categories -->
          <div>
            <h4 class="font-semibold mb-3">Top Categories</h4>
            <ul class="space-y-2 text-sm">
              <li><a href="/categories/best-bouldering-climbing-gyms/1" class="hover:text-sage">Bouldering Gyms</a></li>
              <li><a href="/categories/best-climbing-gyms-for-beginners/1" class="hover:text-sage">For Beginners</a></li>
              <li><a href="/categories/affordable-climbing-gyms/1" class="hover:text-sage">Affordable Gyms</a></li>
              <li><a href="/categories/climbing-gyms-with-sauna/1" class="hover:text-sage">With Sauna</a></li>
              <li><a href="/categories" class="hover:text-sage">All Categories</a></li>
            </ul>
          </div>

          <!-- Column 4: Popular Cities (Dynamic - Top 5 by gym count) -->
          <div>
            <h4 class="font-semibold mb-3">Popular Cities</h4>
            <ul class="space-y-2 text-sm">
              {top5Cities.map(({ city, region, slug }) => {
                const stateCode = getStateCode(region);
                const stateSlug = getStateSlug(region);
                return (
                  <li>
                    <a href={`/${stateSlug}/${slug}/1`} class="hover:text-sage">
                      {city}, {stateCode}
                    </a>
                  </li>
                );
              })}
            </ul>
          </div>

          <!-- Column 5: Company (Renamed from "About") -->
          <div>
            <h4 class="font-semibold mb-3">Company</h4>
            <ul class="space-y-2 text-sm">
              <li><a href="/about" class="hover:text-sage">About Us</a></li>
              <li><a href="/contact" class="hover:text-sage">Contact</a></li>
              <li><a href="/badge" class="hover:text-sage">Get Verified Badge</a></li>
              <li><a href="/privacy" class="hover:text-sage">Privacy</a></li>
              <li><a href="/terms" class="hover:text-sage">Terms</a></li>
            </ul>
          </div>
        </div>

        <!-- Copyright -->
        <div class="border-t border-gray-600 mt-8 pt-8 text-center text-sm">
          <p>© {new Date().getFullYear()} IndoorClimbingGym. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <!-- Mobile Menu Overlay -->
    <div
      id="mobile-menu"
      class="fixed inset-0 bg-black/50 z-50 hidden"
      aria-hidden="true"
    >
      <div class="fixed right-0 top-0 h-full w-4/5 max-w-sm bg-white shadow-2xl transform translate-x-full transition-transform duration-300 ease-in-out flex flex-col">
        <!-- Header Section (Fixed at top) -->
        <div class="flex items-center justify-between px-6 py-4 border-b border-gray-200">
          <span class="text-lg font-bold text-sage">IndoorClimbingGym</span>
          <button
            id="mobile-menu-close"
            type="button"
            class="p-2 text-granite hover:text-sage transition-colors"
            aria-label="Close menu"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M6 18L18 6M6 6l12 12"
              ></path>
            </svg>
          </button>
        </div>

        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-auto">
          <!-- Mobile Auth Nav: Populated by client-side script -->
          <div id="mobile-auth-nav">
            <!-- Loading placeholder -->
            <div class="p-6 text-center text-gray-400 text-sm">Loading...</div>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Mobile menu toggle functionality
      const menuButton = document.getElementById('mobile-menu-button');
      const mobileMenu = document.getElementById('mobile-menu');
      const closeButton = document.getElementById('mobile-menu-close');
      const menuPanel = mobileMenu?.querySelector('div');

      function openMenu() {
        if (mobileMenu && menuPanel) {
          mobileMenu.classList.remove('hidden');
          // Force reflow to ensure transition works
          void menuPanel.offsetWidth;
          menuPanel.classList.remove('translate-x-full');
          menuPanel.classList.add('translate-x-0');
          document.body.style.overflow = 'hidden'; // Prevent body scroll
        }
      }

      function closeMenu() {
        if (mobileMenu && menuPanel) {
          menuPanel.classList.add('translate-x-full');
          menuPanel.classList.remove('translate-x-0');
          setTimeout(() => {
            mobileMenu.classList.add('hidden');
            document.body.style.overflow = ''; // Restore body scroll
          }, 300); // Wait for animation to complete
        }
      }

      // Open menu on button click
      menuButton?.addEventListener('click', openMenu);

      // Close menu on close button click
      closeButton?.addEventListener('click', closeMenu);

      // Close menu on backdrop click
      mobileMenu?.addEventListener('click', (e) => {
        if (e.target === mobileMenu) {
          closeMenu();
        }
      });

      // Close menu on ESC key press (accessibility)
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && mobileMenu && !mobileMenu.classList.contains('hidden')) {
          closeMenu();
        }
      });
    </script>

    <!-- Client-Side Auth Navigation Script -->
    <script define:vars={{ dashboardUrl: import.meta.env.PUBLIC_DASHBOARD_URL, supabaseUrl: import.meta.env.PUBLIC_SUPABASE_URL }}>
      (function() {
        const desktopNav = document.getElementById('desktop-auth-nav');
        const mobileNav = document.getElementById('mobile-auth-nav');

        if (!desktopNav || !mobileNav) return;

        // Helper: Get cookie by name
        function getCookie(name) {
          const value = `; ${document.cookie}`;
          const parts = value.split(`; ${name}=`);
          if (parts.length === 2) return parts.pop().split(';').shift();
          return null;
        }

        // Check for Supabase auth cookie
        const cookieName = `sb-${supabaseUrl.split('//')[1].split('.')[0]}-auth-token`;
        const authCookie = getCookie(cookieName);

        if (authCookie) {
          // User is logged in - show account dropdown (desktop)
          desktopNav.innerHTML = `
            <div class="relative group">
              <button class="flex items-center gap-2 text-granite hover:text-sage transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <span>My Account</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                </svg>
              </button>
              <div class="absolute right-0 mt-2 w-56 bg-white rounded-lg shadow-xl border border-gray-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 z-50">
                <div class="py-2">
                  <a href="${dashboardUrl}/dashboard" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    Dashboard
                  </a>
                  <a href="${dashboardUrl}/dashboard/favorites" class="block px-4 py-2 text-sm text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                    My Favorites
                  </a>
                  <div class="border-t border-gray-200 my-2"></div>
                  <form method="POST" action="${dashboardUrl}/api/auth/signout">
                    <button type="submit" class="w-full text-left px-4 py-2 text-sm text-red-600 hover:bg-red-50 transition-colors">
                      Sign Out
                    </button>
                  </form>
                </div>
              </div>
            </div>
          `;

          // User is logged in - show mobile nav
          mobileNav.innerHTML = `
            <!-- User Status Badge -->
            <div class="p-6">
              <div class="flex items-center gap-3 px-4 py-3 bg-sage/10 rounded-lg">
                <div class="w-10 h-10 bg-sage rounded-full flex items-center justify-center">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <div>
                  <p class="text-sm font-semibold text-granite">Logged In</p>
                  <p class="text-xs text-gray-500">Account Active</p>
                </div>
              </div>
            </div>

            <!-- Account Links Section -->
            <div class="px-6 pb-4">
              <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Account</p>
              <nav class="space-y-1">
                <a href="${dashboardUrl}/dashboard" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
                  </svg>
                  <span class="font-medium">Dashboard</span>
                </a>
                <a href="${dashboardUrl}/dashboard/favorites" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                  </svg>
                  <span class="font-medium">My Favorites</span>
                </a>
              </nav>
            </div>

            <div class="border-t border-gray-200 my-2"></div>

            <!-- Navigation Links Section -->
            <div class="px-6 pb-4">
              <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Explore</p>
              <nav class="space-y-1">
                <a href="/search" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  <span class="font-medium">Search</span>
                </a>
                <a href="/states" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  <span class="font-medium">Browse States</span>
                </a>
                <a href="/categories" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                  </svg>
                  <span class="font-medium">Categories</span>
                </a>
                <a href="/blog" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                  <span class="font-medium">Blog</span>
                </a>
                <a href="/about" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="font-medium">About</span>
                </a>
              </nav>
            </div>

            <div class="border-t border-gray-200 mt-2"></div>

            <!-- Sign Out Section -->
            <div class="p-6">
              <form method="POST" action="${dashboardUrl}/api/auth/signout">
                <button type="submit" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-red-50 text-red-600 rounded-lg font-medium hover:bg-red-100 transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                  </svg>
                  <span>Sign Out</span>
                </button>
              </form>
            </div>
          `;
        } else {
          // User is logged out - show login/signup (desktop)
          desktopNav.innerHTML = `
            <a href="${dashboardUrl}/login" class="text-granite hover:text-sage transition-colors">Login</a>
            <a href="${dashboardUrl}/signup" class="bg-sage text-white px-6 py-2 rounded hover:bg-sage/90 transition-colors">
              Sign Up
            </a>
          `;

          // User is logged out - show mobile nav
          mobileNav.innerHTML = `
            <!-- Sign Up CTA -->
            <div class="p-6">
              <a href="${dashboardUrl}/signup" class="block px-6 py-3 bg-sage text-white text-center rounded-lg font-semibold hover:bg-sage/90 transition-colors shadow-md">
                Sign Up Free
              </a>
              <p class="text-xs text-gray-500 text-center mt-2">Join thousands of climbers</p>
            </div>

            <div class="border-t border-gray-200"></div>

            <!-- Navigation Links Section -->
            <div class="px-6 py-4">
              <p class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-3">Explore</p>
              <nav class="space-y-1">
                <a href="/search" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                  </svg>
                  <span class="font-medium">Search</span>
                </a>
                <a href="/states" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                  <span class="font-medium">Browse States</span>
                </a>
                <a href="/categories" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
                  </svg>
                  <span class="font-medium">Categories</span>
                </a>
                <a href="/blog" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                  </svg>
                  <span class="font-medium">Blog</span>
                </a>
                <a href="/about" class="flex items-center gap-3 px-4 py-3 rounded-lg text-granite hover:bg-sage/10 hover:text-sage transition-colors">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                  </svg>
                  <span class="font-medium">About</span>
                </a>
              </nav>
            </div>

            <div class="border-t border-gray-200"></div>

            <!-- Login Section -->
            <div class="p-6">
              <a href="${dashboardUrl}/login" class="block text-center px-6 py-3 text-granite font-medium hover:bg-sage/10 hover:text-sage rounded-lg transition-colors">
                Already have an account? <span class="text-sage font-semibold">Log In</span>
              </a>
            </div>
          `;
        }
      })();
    </script>

    <!-- Cookie Consent Banner -->
    <CookieConsent />
  </body>
</html>

<style is:global>
  /* Custom color classes for TailwindCSS */
  .text-sage {
    color: #98a48b;
  }
  .bg-sage {
    background-color: #98a48b;
  }
  .text-granite {
    color: #555;
  }
  .bg-granite {
    background-color: #555;
  }
  .text-ivory {
    color: #f8f8f5;
  }
  .bg-ivory {
    background-color: #f8f8f5;
  }
  .hover\:text-sage:hover {
    color: #98a48b;
  }
  .hover\:bg-sage\/90:hover {
    background-color: rgba(152, 164, 139, 0.9);
  }
  .hover\:bg-sage\/10:hover {
    background-color: rgba(152, 164, 139, 0.1);
  }
</style>
